<odoo>
    <record id="partner_traficante_form" model="ir.ui.view">
        <field name="name">res.partner.traficante.form</field>
        <field name="model">res.partner</field>
        <field name="type">form</field>
        <field name="inherit_id" ref="partner_business_name.partner_business_name_form" />
        <field name="arch" type="xml">
            <xpath expr="..//field[@name='is_company']/.." position="before">
                <field name="customer_rank" invisible="1"></field>
                <div attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}">
                    <label for="payment_test_result" string="Payment Clas." />
                    <field string="Pagos" name="payment_test_result" readonly="1"/>
                    |
                    <label for="purchase_test_result" string="Purchase Clas."/>
                    <field string="Compras" name="purchase_test_result" readonly="1"/>
                    <br/>
                </div>
            </xpath>
            <xpath expr="//field[@name='company_type']" position="after">
                <br/>
                <field name="is_distributor" groups="account.group_account_invoice"></field>
                <label for="is_distributor"/>
            </xpath>
            <xpath expr="..//field[@name='business_name']/.." position="after">
                <field name="zone_id" placeholder="Zone"/>
            </xpath>
            <xpath expr=".//field[@name='category_id']" position="replace">
                <field name="est_category_id" string="Category" options="{'no_open': True}" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}"></field>
                <field name="capacity" string="Capacity" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}"></field>
                <field name="size_id" string="Size" readonly="1" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}"></field>
                <field name="category_id" string="Tags" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}" placeholder="Tags..."/>
            </xpath>
            <xpath expr="//group[@name='sale']" position="inside">
                <field name="pmf" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}"></field>
                <field name="pmfxp" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}"></field>
            </xpath>
            <xpath expr="..//page[@name='internal_notes']" position="after">
                <page name="tests" string="Tests" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}">
                    <group name="payment" string="Payment test">
                        <field name="payment_answer_ids">
                            <form>
                                <field name="question_id"></field>
                                <field name="option_id"></field>
                            </form>
                            <tree create="0" delete="0" editable="bottom" default_order="sequence">
                                <field name="sequence" invisible="1"></field>
                                <field name="question_id" readonly="1"></field>
                                <field name="option_id" readonly="0" options="{'no_create_edit': True}"></field>
                            </tree>
                        </field>
                        <field name="payment_test_result"></field>
                    </group>
                    <group name="purchase" string="Purchase test">
                        <field name="purchase_answer_ids">
                            <form>
                                <field name="question_id"></field>
                                <field name="option_id"></field>
                            </form>
                            <tree create="0" delete="0" editable="bottom" default_order="sequence">
                                <field name="sequence" invisible="1"></field>
                                <field name="question_id" readonly="1"></field>
                                <field name="option_id" readonly="0" options="{'no_create_edit': True}"></field>
                            </tree>
                        </field>
                        <field name="purchase_test_result"></field>
                    </group>
                </page>
            </xpath>

            <xpath expr="..//field[@name='vat']" position="after">
                <field name="customer_type"/>
                <field name="establishment_status" attrs="{'invisible' : [('company_type', '=', 'person')]}"/>
            </xpath>
            <xpath expr="//field[@name='vat']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='street']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='street2']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='city']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='state_id']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='zip']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='country_id']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='mobile']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='email']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='start_delivery_time']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='finish_delivery_time']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <xpath expr="//field[@name='bank_ids']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A')]}</attribute>
            </xpath>

            <!-- Para poner campos forzosos en el formuario de las direcciones asociadas -->
            <xpath expr="//field[@name='child_ids']" position="attributes">
                <attribute name="context">{'default_parent_id': active_id, 'default_street': street, 'default_street2': street2, 'default_city': city, 'default_state_id': state_id, 'default_zip': zip, 'default_country_id': country_id, 'default_lang': lang, 'default_user_id': user_id, 'default_type': 'other', 'default_customer_type': customer_type}</attribute>
            </xpath>

            <xpath expr="//field[@name='child_ids']/kanban/field[@name='display_name']" position="after">
                <field name='customer_type'/>
            </xpath>

            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="after">
                <field name='customer_type' invisible="1"/>
            </xpath>

            <xpath expr="//field[@name='child_ids']/form//field[@name='name']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='street']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='street2']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='city']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='state_id']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='zip']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='country_id']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='email']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']/form//field[@name='mobile']" position="attributes">
                <attribute name="attrs">{'required' : [('customer_type', '=', 'A'), '|', ('type', '=', 'invoice'), ('type', '=', 'delivery')]}</attribute>
            </xpath>

        </field>
    </record>

    <record id="res_partner_test_result_kanban_view" model="ir.ui.view">
        <field name="inherit_id" ref="base.res_partner_kanban_view"></field>
        <field name="name">res.partner.test.result.kanban.view</field>
        <field name="model">res.partner</field>
        <field name="type">kanban</field>
        <field name="arch" type="xml">
            <field name="mobile" position="after">
                <field name="customer_rank"></field>
                <field name="payment_test_result"></field>
                <field name="purchase_test_result"></field>
                <field name="establishment_status"></field>
                <field name="company_type"></field>
            </field>
            <div class="oe_kanban_partner_links" position="inside">
                <span class="badge badge-pill" title="Payment clasification" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}">
                    <t t-esc="record.payment_test_result.value"/>
                </span>
                <span class="badge badge-pill" title="Purchase clasification" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}">
                    <t t-esc="record.purchase_test_result.value"/>
                </span>
            </div>
            <div class="oe_kanban_details" position="after">
                <div class="o_kanban_record_bottom">
                    <div class="oe_kanban_bottom_right">
                        <span class="badge badge-pill" title="Estado del establecimiento" attrs="{'invisible' : [('company_type', '=', 'person')]}">
                            <t t-esc="record.establishment_status.value"/>
                        </span>
                    </div>
                </div>
            </div>
        </field>
    </record>

    <record id="res_partner_test_inh_tree_view" model="ir.ui.view">
        <field name="inherit_id" ref="base.view_partner_tree"></field>
        <field name="name">res.partner.test.inh.tree.view</field>
        <field name="model">res.partner</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
            <field name="display_name" position="after">
                <field name="payment_test_result" optional="show"></field>
                <field name="purchase_test_result" optional="show"></field>
            </field>
            <field name="company_id" position="after">
                <field name="establishment_status" optional="hide"></field>
            </field>
        </field>
    </record>

    <record id="account_view_partner_property_form_delivery_times" model="ir.ui.view">
        <field name="name">account.view.partner.property.form.delivery.times</field>
        <field name="model">res.partner</field>
        <field name="type">form</field>
        <field name="inherit_id" ref="account.view_partner_property_form" />
        <field name="arch" type="xml">
            <group name="sale" position="inside">
                <field name="default_journal_id" widget="selection"/>
            </group>
            <group name="sale" position="attributes">
                <attribute name="groups">sales_team.group_sale_salesman,account.group_account_invoice</attribute>
            </group>
            <xpath expr="..//field[@name='property_supplier_payment_term_id']/.." position="before">
                <group string="Delivery time" groups="sales_team.group_sale_salesman,account.group_account_invoice" attrs="{'invisible' : [('customer_rank', '&lt;=', 0)]}">
                    <field string="From" name="start_delivery_time" widget="float_time"></field>
                    <field string="To" name="finish_delivery_time" widget="float_time"></field>
                </group>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_res_partner_filter_inherit_reference">
        <field name="inherit_id" ref="base.view_res_partner_filter"></field>
        <field name="model">res.partner</field>
        <field name="arch" type="xml">
            <xpath expr="..//filter[@name='type_company']" position="after">
                <filter name="distributors" string="Distributors" domain="[('is_distributor', '=', True)]"/>
            </xpath>
            <xpath expr="//field[@name='name']" position="attributes">
                <attribute name="filter_domain">['|', '|', ('display_name', 'ilike', self), ('ref', 'ilike', self), ('email', 'ilike', self)]</attribute>
            </xpath>
            <xpath expr="//filter[@name='salesperson']" position="before">
                <filter name="est_category" string="Category" context="{'group_by': 'est_category_id'}"></filter>
            </xpath>
            <xpath expr="..//filter[@name='inactive']" position="before">
                <filter name="abierto" string="Abiertos" domain="[('company_type', '=', 'company'),('establishment_status', '=', 'A')]"/>
                <filter name="cerrado" string="Cerrados" domain="[('company_type', '=', 'company'),('establishment_status', '=', 'C')]"/>
                <separator/>
            </xpath>
        </field>
    </record>

    <!-- Acciotn para activar la vista de arbol de prospectos -->
    <record model="ir.actions.act_window" id="res_partner_prospectos_tree">
        <field name="name">Prospectos</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('customer_type','=','P')]</field>
        <field name="context">{'default_is_company': True, 'default_company_id': allowed_company_ids[0]}</field>
    </record>

    <!-- Accion para activar la vista de arbol de clientes suspendidos-->
    <record model="ir.actions.act_window" id="res_partner_suspendidos_tree">
        <field name="name">Suspendidos</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('customer_type','=','X')]</field>
        <field name="context">{'default_is_company': True, 'default_company_id': allowed_company_ids[0]}</field>
    </record>

    <!-- Modificación de la accion para crear contactos para que se establezca la compañía por defecto-->
    <record model="ir.actions.act_window" id="contacts.action_contacts">
        <field name="context">{'default_is_company': True, 'default_company_id': allowed_company_ids[0]}</field>
    </record>
    <record model="ir.actions.act_window" id="account.res_partner_action_customer">
        <field name="context">{'search_default_customer': 1,'res_partner_search_mode': 'customer', 'default_is_company': True, 'default_customer_rank': 1, 'default_company_id': allowed_company_ids[0]}</field>
    </record>

    <!-- Elemento del menú para ver los prospectos-->
    <menuitem name="Prospectos" sequence="5" action="res_partner_prospectos_tree" id="res_partner_prospectos_menu" parent="sale.sale_order_menu"/>

    <!-- Elemento del menú para ver los clientes suspendidos-->
    <menuitem name="Suspendidos" sequence="6" action="res_partner_suspendidos_tree" id="res_partner_suspendidos_menu" parent="sale.sale_order_menu"/>

    <!-- INVOICE AVERAGE CRON -->
    <record model="ir.cron" id="daily_invoiced_avg_cron">
        <field name="name">Set daily invoiced avg</field>
        <field name="model_id" ref="model_account_invoice_avg"></field>
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>
        <field name="active" eval="True"></field>
        <field name="numbercall">-1</field>
        <field name="doall" eval="True"></field>
        <field name="state">code</field>
        <field name="code">
            model.update_all_daily_avg()
        </field>
    </record>

    <!-- Size assignment for imported partners-->
    <record model="ir.cron" id="display_name_update_with_business_name">
        <field name="name">Actualizar el nombre de los clientes con razon social</field>
        <field name="model_id" ref="base.model_res_partner"></field>
        <field name="active" eval="True"></field>
        <field name="state">code</field>
        <field name="code">
            # Available variables:
#  - env: Odoo Environment on which the action is triggered
#  - model: Odoo Model of the record on which the action is triggered; is a void recordset
#  - record: record on which the action is triggered; may be void
#  - records: recordset of all records on which the action is triggered in multi-mode; may be void
#  - time, datetime, dateutil, timezone: useful Python libraries
#  - log: log(message, level='info'): logging function to record debug information in ir.logging table
#  - Warning: Warning Exception to use with raise
# To return an action, assign: action = {...}

partners = env['res.partner'].search([])

for partner in partners:
  partner._compute_display_name()
            
        </field>
    </record>

    <record model="ir.cron" id="size_assignment_for_imported_action">
        <field name="name">Assign size to imported partner records</field>
        <field name="model_id" ref="base.model_res_partner"></field>
        <field name="active" eval="True"></field>
        <field name="state">code</field>
        <field name="code">
            # Available variables:
#  - env: Odoo Environment on which the action is triggered
#  - model: Odoo Model of the record on which the action is triggered; is a void recordset
#  - record: record on which the action is triggered; may be void
#  - records: recordset of all records on which the action is triggered in multi-mode; may be void
#  - time, datetime, dateutil, timezone: useful Python libraries
#  - log: log(message, level='info'): logging function to record debug information in ir.logging table
#  - Warning: Warning Exception to use with raise
# To return an action, assign: action = {...}

partners = env['res.partner'].search([])

for partner in partners:
  partner._onchange_get_est_size()
            
        </field>
    </record>

</odoo>